<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>GEORGES QSO LOG - 26-CT-1664</title>
<style>
  body {
    background: #000022;
    color: #0ff;
    font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
    display: flex;
    justify-content: center;
    align-items: flex-start;
    padding: 20px;
    gap: 20px;
  }
  .image-container {
    text-align: center;
    max-width: 140px;
  }
  .image-container img {
    width: 100%;
    height: auto;
    border: 4px solid #00bfff;
    border-radius: 10px;
    animation: flashBlue 3s infinite;
  }
  .image-label {
    margin-top: 8px;
    font-weight: bold;
    color: #00bfff;
    font-size: 14px;
  }
  @keyframes flashBlue {
    0%, 100% { box-shadow: 0 0 10px #00bfff; }
    50% { box-shadow: 0 0 20px #00ffff; }
  }
  table {
    border-collapse: collapse;
    min-width: 700px;
    max-width: 900px;
  }
  th, td {
    padding: 6px 12px;
    text-align: center;
    border: none;
    color: #0ff;
  }
  /* Spacer columns are blank and narrow */
  .spacer {
    width: 12px;
    background: transparent;
    pointer-events: none;
  }
  th {
    background: linear-gradient(90deg, #005577, #0099cc);
    border-bottom: 2px solid #00bfff;
    font-weight: 700;
    font-size: 14px;
  }
  tbody tr:nth-child(odd) {
    background: rgba(0, 191, 255, 0.1);
  }
  tbody tr:hover {
    background: rgba(0, 191, 255, 0.3);
    transition: background 0.3s ease;
  }
</style>
</head>
<body>

<!-- Left image -->
<div class="image-container">
  <img src="https://media.discordapp.net/attachments/1272935566035652695/1379946818619703377/494740562_1046815160662024_7184481897838236543_n.jpg" alt="Antenna" />
  <div class="image-label">Antenna</div>
</div>

<!-- QSO Log Table -->
<table id="qsoTable">
  <thead>
    <tr>
      <th>Date</th><th class="spacer"></th>
      <th>Time</th><th class="spacer"></th>
      <th>Frequency</th><th class="spacer"></th>
      <th>Mode</th><th class="spacer"></th>
      <th>Location</th><th class="spacer"></th>
      <th>Contact Name</th><th class="spacer"></th>
      <th>My Signal</th>
    </tr>
  </thead>
  <tbody>
    <!-- Rows will be inserted here -->
  </tbody>
</table>

<!-- Right image -->
<div class="image-container">
  <img src="https://media.discordapp.net/attachments/1272935566035652695/1379946819055915028/495291255_1051152326894974_7591054905816117297_n.jpg" alt="Rig" />
  <div class="image-label">Rig</div>
</div>

<script>
  const csvUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQn_XSyS8DIfkZfQr8g1NDN4ZJLeO3LnOR87tOj3d1GybMhUCS0gtyyyKcvUshmFfGefofdlYcuDlqI/pub?output=csv";

  function parseCSV(text) {
    const lines = text.trim().split("\n");
    return lines.map(line => {
      // Split by comma but consider quoted commas
      const result = [];
      let current = "";
      let inQuotes = false;
      for (let i = 0; i < line.length; i++) {
        const char = line[i];
        if (char === '"' ) {
          inQuotes = !inQuotes;
        } else if (char === "," && !inQuotes) {
          result.push(current);
          current = "";
        } else {
          current += char;
        }
      }
      result.push(current);
      return result;
    });
  }

  function updateTable(data) {
    const tbody = document.querySelector("#qsoTable tbody");
    tbody.innerHTML = "";

    // We want to pick columns in this order (with gaps as empty cells):
    // Columns in your CSV might be:
    // Date (col 0), Time(1), Frequency(2), Mode(3), Location(4), Contact Name(5), My Signal(6)
    // We'll insert spacer columns between them.

    // Confirm the CSV header to detect correct indices (optional):
    const header = data[0].map(h => h.toLowerCase());

    const dateCol = header.indexOf("date");
    const timeCol = header.indexOf("time");
    const freqCol = header.indexOf("frequency");
    const modeCol = header.indexOf("mode");
    const locationCol = header.indexOf("location");
    const contactCol = header.indexOf("contact name");
    const signalCol = header.indexOf("my signal");

    // If any column not found, fallback with assumed indices
    function safeIndex(idx, fallback) {
      return idx >= 0 ? idx : fallback;
    }

    for (let i = 1; i < data.length; i++) {
      const row = data[i];
      const tr = document.createElement("tr");

      // Date
      tr.appendChild(createCell(row[safeIndex(dateCol, 0)]));
      tr.appendChild(createSpacer());
      // Time
      tr.appendChild(createCell(row[safeIndex(timeCol, 1)]));
      tr.appendChild(createSpacer());
      // Frequency
      tr.appendChild(createCell(row[safeIndex(freqCol, 2)]));
      tr.appendChild(createSpacer());
      // Mode
      tr.appendChild(createCell(row[safeIndex(modeCol, 3)]));
      tr.appendChild(createSpacer());
      // Location
      tr.appendChild(createCell(row[safeIndex(locationCol, 4)]));
      tr.appendChild(createSpacer());
      // Contact Name
      tr.appendChild(createCell(row[safeIndex(contactCol, 5)]));
      tr.appendChild(createSpacer());
      // My Signal
      tr.appendChild(createCell(row[safeIndex(signalCol, 6)]));

      tbody.appendChild(tr);
    }
  }

  function createCell(text) {
    const td = document.createElement("td");
    td.textContent = text || "";
    return td;
  }

  function createSpacer() {
    const td = document.createElement("td");
    td.classList.add("spacer");
    td.textContent = "";
    return td;
  }

  async function fetchAndUpdate() {
    try {
      const response = await fetch(csvUrl);
      if (!response.ok) throw new Error("Network response was not ok");
      const text = await response.text();
      const data = parseCSV(text);
      updateTable(data);
    } catch (e) {
      console.error("Error fetching CSV:", e);
      const tbody = document.querySelector("#qsoTable tbody");
      tbody.innerHTML = "<tr><td colspan='13'>Error loading QSO log data.</td></tr>";
    }
  }

  // Initial load
  fetchAndUpdate();

  // Refresh every 5 minutes
  setInterval(fetchAndUpdate, 300000);
</script>

</body>
</html>
